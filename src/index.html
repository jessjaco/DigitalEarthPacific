<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
<script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
<link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />
<style>
body { margin: 0;}
#map {
  height: 100vh;
  width: 100vw;
}

</style>
</head>

<body>
  <div id="map">

  </div>
  

</body>
<script>

  class SelectControl {
    constructor(id) {
      this.element = document.createElement("select");
      this.element.className = "mapboxgl-ctrl";
    }

    onAdd(map) {
      this._map = map;
      return this.element;
    }
     
    onRemove() {
      this._container.parentNode.removeChild(this._container);
      this._map = undefined;
    }
  }

  const basestyle = {
    "version": 8,
    "sources": {
      "osm": {
        "type": "raster",
        "tiles": ["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],
        "tileSize": 256,
        "attribution": "&copy; OpenStreetMap Contributors",
        "maxzoom": 19
      }
    },
    "layers": [
      {
        "id": "osm",
        "type": "raster",
        "source": "osm" // This must match the source key above
      }
    ]
  };

  const years = ['2015', '2016', '2017', '2018', '2019', '2020', '2021'];

  function makeVisible(id) {
    years.forEach(year => {
      visible = year === id ? "visible": "none";
      Map.setLayoutProperty(`evi_${year}`, 'visibility', visible);
    });
  }

  var Map = new maplibregl.Map({
    container: 'map',
    style: basestyle,
    center: [-180, -10], // starting position [lng, lat]
    zoom: 4 // starting zoom
  });

  Map.on('load', () => {
    years.forEach((year) => {
      const id = `evi_${year}`;
      Map.addSource(id, {
        scheme: 'tms',
        type: 'raster',
        tiles: [`https://deppcpublicstorage.blob.core.windows.net/output/tiles/${id}/{z}/{x}/{y}.png`],
        tileSize: 512,
        maxzoom: 11
      });
      Map.addLayer({
        id: id,
        source: id,
        type: "raster",
        layout: {visibility: "none"}
      });

    });
    makeVisible('2015');


    const selector = new SelectControl("selector");
    selector.element.addEventListener('change', e => {
      makeVisible(e.target.value);
    }, false);
    
    years.forEach(year =>{ 
      const option = document.createElement("option");
      option.textContent = year;
      option.value = year;
      selector.element.appendChild(option);
    });
    Map.addControl(selector, 'top-left');
  });
</script>
</html>
